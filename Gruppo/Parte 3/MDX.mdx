-- Show the player that lost the most matches for each country.

select  [Measures].[Match count] on columns,
order(
        generate(
            ([Loser - Country].[Country Name].[Country Name]),
            topcount(([Loser - Country].[Country Name].currentmember, [Loser].[Player Id].[Player Id]), 1,  [Measures].[Match count])
            ), 
         [Measures].[Match count],
        bdesc
    ) on rows
from [Group 11 DB]



-- For each tournament, show the loser with the lowest total loser rank points.
select [Measures].[Loser Rank Points] on columns,
generate(
     [Tournament].[Tourney Pk].[Tourney Pk],
     bottomcount(
		filter(
			([Tournament].[Tourney Pk].currentmember, [Loser].[Player Id].[Player Id]), 
			NOT ISEMPTY([Measures].[Loser Rank Points])
		), 
		1,  
		[Measures].[Loser Rank Points])
)
on rows
from [Group 11 DB]





-- For each tournament, show the loser with the highest ratio between his loser rank
-- points and the average winner rank points of that tournament.

with member maxLoserRankPoints as 
	max(
		([Tournament].[Tourney Pk].currentmember, [Match].[Match Id].[Match Id]),  
		[Measures].[Loser Rank Points]
	)
member avgWinnerRankPoints as 
	avg(
		([Tournament].[Tourney Pk].currentmember, [Match].[Match Id].[Match Id]),  
		[Measures].[Winner Rank Points]
	)
member rateo as maxLoserRankPoints/avgWinnerRankPoints
select {maxLoserRankPoints, avgWinnerRankPoints, rateo} on columns,
[Tournament].[Tourney Pk].[Tourney Pk] on rows
from [Group 11 DB]



with member avgWinnerRankPoints as 
	avg(
		([Tournament].[Tourney Pk].currentmember, [Match].[Match Id].[Match Id]),  
		[Measures].[Winner Rank Points]
	)
select [Measures].[Loser Rank Points]/avgWinnerRankPoints  on columns,
generate(
     [Tournament].[Tourney Pk].[Tourney Pk],
     topcount(([Tournament].[Tourney Pk].currentmember, [Loser].[Player Id].[Player Id]), 
		1,  
		[Measures].[Loser Rank Points]/avgWinnerRankPoints)
)
on rows
from [Group 11 DB]


with member avgWinnerRankPoints as 
	avg(
		([Tournament].[Tourney Pk].currentmember, [Match].[Match Id].[Match Id]),  
		[Measures].[Winner Rank Points]
	)
member test as [Measures].[Loser Rank Points]/avgWinnerRankPoints
select {[Measures].[Loser Rank Points], avgWinnerRankPoints, test} on columns,
generate(
     [Tournament].[Tourney Pk].[Tourney Pk],
     topcount(
		filter(
			([Tournament].[Tourney Pk].currentmember, [Loser].[Player Id].[Player Id]), 
			NOT ISEMPTY([Measures].[Loser Rank Points])
		), 
		1,  
		test)
)
on rows
from [Group 11 DB]
